---
layout: post
title: "Electron"
date: 2023-12-12 9:00:00
categories: "Web"
catalog: true
tags:
  - Web
---

# Electron
1. 首先创建一个文件夹并初始化 npm 包。  

        mkdir my-electron-app && cd my-electron-app
        npm init

2. 将`entry point`改为`main.js`.
3. 然后，将 electron 包安装到应用的开发依赖中。  

        npm install --save-dev electron

4. 在package.json配置文件中的scripts字段下增加一条start命令：    

        {
          "scripts": {
            "start": "electron ."
          }
        }

5. 在项目的根目录下创建一个名为main.js的空文件。  
6. 在您的项目根目录下创建一个名为index.html的文件  

        <!DOCTYPE html>
        <html>
          <head>
            <meta charset="UTF-8">
            <!-- https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP -->
            <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">
            <title>你好!</title>
          </head>
          <body>
            <h1>你好!</h1>
            我们正在使用 Node.js <span id="node-version"></span>,
            Chromium <span id="chrome-version"></span>,
            和 Electron <span id="electron-version"></span>.
          </body>
        </html>


7. 现在我们有了一个html页面，如果想将它加载进应用窗口中，需要两个Electron模块：

    + app 模块，它控制应用程序的事件生命周期。  
    + BrowserWindow 模块，它创建和管理应用程序 窗口。  

    在 main.js 文件头部将它们导入作为 CommonJS 模块：  

        const { app, BrowserWindow } = require('electron')

8. 添加一个createWindow()方法来将index.html加载进一个新的BrowserWindow实例。  

        const createWindow = () => {
          const win = new BrowserWindow({
            width: 800,
            height: 600
          })

          win.loadFile('index.html')
        }

9. 调用createWindow()函数来打开您的窗口。在 Electron 中，只有在 app 模块的 ready 事件被激发后才能创建浏览器窗口。 您可以通过使用 app.whenReady() API来监听此事件。 在whenReady()成功后调用createWindow()。  

        app.whenReady().then(() => {
          createWindow()
        })

10. 管理窗口的生命周期  
虽然你现在可以打开一个浏览器窗口，但你还需要一些额外的模板代码使其看起来更像是各平台原生的。 应用程序窗口在每个OS下有不同的行为，Electron将在app中实现这些约定的责任交给开发者们。  
在Windows和Linux上，关闭所有窗口通常会完全退出一个应用程序。  
为了实现这一点，你需要监听 app 模块的 'window-all-closed' 事件。如果用户不是在 macOS(darwin) 上运行程序，则调用 app.quit()。  

        app.on('window-all-closed', () => {
          if (process.platform !== 'darwin') app.quit()
        })

11. 通过预加载脚本从渲染器访问Node.js  
创建一个名为 preload.js 的新脚本如下：  

        window.addEventListener('DOMContentLoaded', () => {
          const replaceText = (selector, text) => {
            const element = document.getElementById(selector)
            if (element) element.innerText = text
          }

          for (const dependency of ['chrome', 'node', 'electron']) {
            replaceText(`${dependency}-version`, process.versions[dependency])
          }
        })

12. 修改main.js  

        const { app, BrowserWindow } = require('electron')
        // include the Node.js 'path' module at the top of your file
        const path = require('node:path')

        // modify your existing createWindow() function
        const createWindow = () => {
          const win = new BrowserWindow({
            width: 800,
            height: 600,
            webPreferences: {
              preload: path.join(__dirname, 'preload.js')
            }
          })

          win.loadFile('index.html')
        }
        // ...

# 打包
最快捷的打包方式是使用 Electron Forge。  

1. 在package.json中添加description，不然Build会失败
2. 添加 Electron Forge 依赖

        npm install --save-dev @electron-forge/cli
        npx electron-forge import

3. 使用 Forge 的 make 命令来创建可分发的应用程序：  

        npm run make

    Electron-forge 会创建 out 文件夹  

# Reference
[Quick Start](https://www.electronjs.org/docs/latest/tutorial/quick-start)  
[Angular for Desktop Applications with Electron](https://www.logicflow.ai/blog/angular-desktop-applications-with-electron)  
[Creating a Desktop App with Electron and Angular](https://buddy.works/tutorials/building-a-desktop-app-with-electron-and-angular)  