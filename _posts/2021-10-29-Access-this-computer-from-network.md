---                
layout: post                
title: "Access this computer from the network"                
date:   2021-10-29 10:30:00                 
categories: "WCF"                
catalog: true                
tags:                 
    - WCF                
---      

最近遇到一个客户问题，我们的程序没法连接WCF服务。  
一番研究之后发现问题出在客户端机器security policy setting。用户删掉了`Users`用户组，导致出了问题。  
![img](https://github.com/kerwenzhang/kerwenzhang.github.io/blob/master/_posts/image/network.png?raw=true)   

The Access this computer from the network policy setting determines which users can connect to the device from the network.   
Users, devices, and service accounts gain or lose the Access this computer from network user right by being explicitly or `implicitly` added or removed from a security group that has been granted this user right.   
 By default, user accounts and machine accounts are granted the Access this computer from network user right when computed groups such as Authenticated Users, and for domain controllers, the Enterprise Domain Controllers group, are defined in the default domain controllers Group Policy Object (GPO).   
 This setting includes the Everyone group to ensure backward compatibility. Upon Windows upgrade, after you have verified that all users and groups are correctly migrated, you should remove the Everyone group and use the Authenticated Users group instead.   
  If you have installed optional components such as ASP.NET or Internet Information Services (IIS), you may need to assign this user right to additional accounts that are required by those components.   

  Network Service is a built-in Windows identity. It doesn't require a password and has only user privileges; that is, it is relatively low-privileged.   
  The Windows operating system provides a feature called "virtual accounts" that allows IIS to create a unique identity for each of its application pools.   
  Whenever a new application pool is created, the IIS management process creates a security identifier (SID) that represents the name of the application pool itself. the identity is not a real user account; it will not show up as a user in the Windows User Management Console.  
  IIS will run worker processes as the application pool identity. With every other identity type, the security identifier will only be injected into the access token of the process. If the identifier is injected, content can still be ACLed for the ApplicationPoolIdentity, but the owner of the token is probably not unique.   

  In Windows Server 2008 R2 and Windows 7, one managed service account can be used for services on a single computer. Managed service accounts cannot be shared between multiple computers and cannot be used in server clusters where a service is replicated on multiple cluster nodes.  

  When IIS starts a worker process, it must create a token that the process will use. When this token is created, IIS automatically adds the IIS_IUSRS membership to the worker processes token at runtime. The accounts that run as application pool identities no longer have to be an explicit part of the IIS_IUSRS group. 

  Worker process running as Network Service access the network as the machine account. Machine accounts are generated when a machine is joined to a domain.  
  ApplicationPoolIdentity is a LOCAL user (generated by IIS, its identity is not known until runtime) thus any attempt to access anything on the network would result in it using the COMPUTER$ account.  

  The domain\machine-name$ naming convention is used to denote the computer account of a domain joined machine. In regards to its usability, any service running as Local System or Network Service on that machine will authenticate across the network as domain\machine-name$.  

  When a service runs under the LocalSystem account on a computer that is a domain member, the service has whatever network access is granted to the computer account, or to any groups of which the computer account is a member.   
  Computer accounts typically have few privileges and do not belong to groups.  

  Authenticated Users includes every authenticated object to Active Directory, which would include all domain users, groups (defined and part of AD), and computers that have been joined to the domain.  

  Computers are members of the Authenticated Users group.   

## Reference  
[Access this computer from the network - security policy setting](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/access-this-computer-from-the-network)  
[Client, service, and program issues can occur if you change security settings and user rights assignments](https://support.microsoft.com/en-us/topic/client-service-and-program-issues-can-occur-if-you-change-security-settings-and-user-rights-assignments-0cb6901b-dcbf-d1a9-e9ea-f1b49a56d53a)  
[Application Pool Identities](https://docs.microsoft.com/en-us/iis/manage/configuring-security/application-pool-identities)   
[Service Accounts Step-by-Step Guide](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd548356(v=ws.10))  
[Understanding identities in IIS](https://docs.microsoft.com/en-us/troubleshoot/iis/understanding-identities)  
[IIS7 give ApplicationPoolIdentity access to a network location](https://stackoverflow.com/questions/18750341/iis7-give-applicationpoolidentity-access-to-a-network-location/18753662)  
[What does domain name\computer name $ mean?](https://serverfault.com/questions/66660/what-does-domain-name-computer-name-mean)  
[](https://docs.microsoft.com/en-us/windows/win32/ad/the-localsystem-account?redirectedfrom=MSDN)  
[Top 10 Reasons Why Group Policy Fails to Apply ](https://techgenix.com/top-10-reasons-why-group-policy-fails-to-apply-part2/)  
[Policy settings incorrectly applied or denied due to security filtering](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc759506(v=ws.10)?redirectedfrom=MSDN)  