---                
layout: post            
title: "Signal R"                
date:   2022-1-26 17:30:00                 
categories: ".Net Core"                
catalog: true                
tags:                 
    - .Net Core                
---      

ASP.NET Core SignalR 是一个开放源代码库，可用于简化向应用添加实时 Web 功能。 实时 Web 功能使服务器端代码能够将内容推送到客户端。  
SignalR 支持以下用于处理实时通信的技术（按正常回退的顺序）：  

WebSockets  
Server-Sent Events  
长轮询  
SignalR 自动选择服务器和客户端能力范围内的最佳传输方法。  

# Server

1. 创建一个新的ASP.NET Core Web Api工程， 工程名：SignalRServer  
2. Nuget添加SignalR引用  
   ![img](https://github.com/kerwenzhang/kerwenzhang.github.io/blob/master/_posts/image/SignalR1.png?raw=true)

3. 添加新的文件夹Service, 在Services下添加新的接口文件`ISignalRHub.cs`  
   在此接口文件里定义我们想在SignalR Client端要接收的消息  

        namespace SignalRServer.Services
        {
            public interface ISignalRHub
            {
                Task ReceiveMessage(string data);
            }
        }

4. 在Services下添加新的类`SignalRHub.cs`  
   
        using Microsoft.AspNetCore.SignalR;
        namespace SignalRServer.Services
        {
            public class SignalRHub : Hub<ISignalRHub>
            {
                public void GenerateData()
                {
                    Clients.All.ReceiveMessage("Start to receive data from SignalR Server.");
                    var random = new Random();
                    for (int i = 10; i > 0; i--)
                    {
                        Clients.All.ReceiveMessage(random.Next(0, 100).ToString());
                        Thread.Sleep(2000);
                    }
                    Clients.All.ReceiveMessage("End to receive data from SignalR Server.");
                }
            }
        }

5. 修改`Program.cs`，添加SignalR的引用
   
        using SignalRServer.Services;

        var builder = WebApplication.CreateBuilder(args);

        // Add services to the container.

        builder.Services.AddControllers();
        // Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle
        builder.Services.AddEndpointsApiExplorer();
        builder.Services.AddSwaggerGen();
        builder.Services.AddSignalR();

        var app = builder.Build();

        // Configure the HTTP request pipeline.
        if (app.Environment.IsDevelopment())
        {
            app.UseSwagger();
            app.UseSwaggerUI();
        }

        app.UseHttpsRedirection();

        app.UseAuthorization();

        app.MapControllers();
        app.MapHub<SignalRHub>("signalrdemo");

        app.Run();

# Client

1. 创建新的Angular工程`ng new SignalRClient`  
2. 添加SignalR安装包 `npm install @microsoft/signalr`
3. 添加新的Service `ng g service services/SignalR`
4. 在SignalR service里添加引用
   
        import * as signalR from '@microsoft/signalr';
        import { ReplaySubject } from 'rxjs';


[ASP.NET Core SignalR 简介](https://docs.microsoft.com/zh-cn/aspnet/core/signalr/introduction?WT.mc_id=dotnet-35129-website&view=aspnetcore-6.0)  
[.NET Core with SignalR and Angular – Real-Time Charts](https://code-maze.com/netcore-signalr-angular-realtime-charts/)  
[Real-time Angular 11 Application With SignalR And .NET 5](https://www.c-sharpcorner.com/article/real-time-angular-11-application-with-signalr-and-net-5/)  
[Real-time Angular Application With SignalR And ASP .NET Core](https://www.thecodehubs.com/real-time-angular-application-with-signalr-and-asp-net-core/)  
[SignalR开篇以及如何指定传输协议](https://www.cnblogs.com/yaopengfei/p/9276234.html)  